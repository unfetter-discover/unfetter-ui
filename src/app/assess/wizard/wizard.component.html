<div class="sidenav">
  <div *ngIf="currentAssessmentGroup" class="flex-col mt-18 mb-12">
    <div class="center chart-header">
      Overall Rating
    </div>
    <div style="display: block">
      <canvas baseChart [datasets]="doughnutChartData" [labels]="doughnutChartLabels" [chartType]="doughnutChartType" [colors]="doughnutChartColors"
        [options]="chartOptions"></canvas>
    </div>
  </div>
  <mat-accordion displayMode="flat" multi="false">
    <mat-expansion-panel *ngIf="indicators && indicators.length > 0" hideToggle="true" [expanded]="openedSidePanel === 'indicators'" (opened)="onOpenSidePanel('indicators', $event)">
      <mat-expansion-panel-header [expandedHeight]="sidePanelExpandedHeight" [collapsedHeight]="sidePanelCollapseHeight">
        <mat-panel-title>
          INDICATORS
        </mat-panel-title>
      </mat-expansion-panel-header>
      <ul class="stepper stepper-vertical">
        <li [class.active]="navigation.page === page" *ngFor="let navigation of navigations">
          <a href (click)="navigationClicked(navigation.page, $event)">
            <span class="circle">&nbsp;</span>
            <span class="label">{{navigation.label}}</span>
          </a>
        </li>
      </ul>
    </mat-expansion-panel>
    <mat-expansion-panel *ngIf="mitigations && mitigations.length > 0" hideToggle="true" [expanded]="openedSidePanel === 'mitigations'" (opened)="onOpenSidePanel('mitigations', $event)">
      <mat-expansion-panel-header [expandedHeight]="sidePanelExpandedHeight" [collapsedHeight]="sidePanelCollapseHeight">
        <mat-panel-title>
          MITIGATIONS
        </mat-panel-title>
      </mat-expansion-panel-header>
      <ul class="stepper stepper-vertical">
        <li [class.active]="navigation.page === page" *ngFor="let navigation of navigations">
          <a href (click)="navigationClicked(navigation.page, $event)">
            <span class="circle">&nbsp;</span>
            <span class="label">{{navigation.label}}</span>
          </a>
        </li>
      </ul>
    </mat-expansion-panel>
    <mat-expansion-panel *ngIf="sensors && sensors.length > 0" hideToggle="true" [expanded]="openedSidePanel === 'sensors'" (opened)="onOpenSidePanel('sensors', $event)">
      <mat-expansion-panel-header [expandedHeight]="sidePanelExpandedHeight" [collapsedHeight]="sidePanelCollapseHeight">
        <mat-panel-title>
          SENSORS
        </mat-panel-title>
      </mat-expansion-panel-header>
      <ul class="stepper stepper-vertical">
        <li [class.active]="navigation.page === page" *ngFor="let navigation of navigations">
          <a href (click)="navigationClicked(navigation.page, $event)">
            <span class="circle">&nbsp;</span>
            <span class="label">{{navigation.label}}</span>
          </a>
        </li>
      </ul>
    </mat-expansion-panel>
  </mat-accordion>
</div>

<div class="card flex1">
  <mat-card>
    <div *ngIf="showSummarry">
      <mat-card-header>
        <mat-card-title>Assessment Report</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="row mat-card-padding">
          <div class="col-xs-8">
            <mat-form-field class="full-width">
              <input matInput placeholder="Assessment Name" name="assessment-name" [(ngModel)]="assessmentName">
            </mat-form-field>
          </div>
          <div class="col-xs-4">

            <mat-form-field class="full-width">
              <input matInput [matDatepicker]="picker" placeholder="Published" [(ngModel)]="publishDate">
              <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
              <mat-datepicker #picker></mat-datepicker>
            </mat-form-field>
          </div>
        </div>
        <div class="row mat-card-padding">
          <div class="col-xs-12">
            <mat-form-field class="full-width">
              <textarea matInput placeholder="Assessment Description" [(ngModel)]="assessmentDescription"></textarea>
            </mat-form-field>
          </div>
        </div>
      </mat-card-content>
    </div>

    <div *ngIf="currentAssessmentGroup">
      <mat-card-content>
        <div class="row top-row">
          <div class="col-xs-12">
            Progress
            <mat-progress-bar [value]="ratioOfQuestionsAnswered">
            </mat-progress-bar>
          </div>
        </div>
        <div class="row margin-bottom flex-sm flexItemsCenter">
          <div class="col-sm-9 group-name">
            {{currentAssessmentGroup.name | capitalize }}
          </div>
        </div>
        <div class="row margin-bottom" *ngFor="let assessment of currentAssessmentGroup.assessments">
          <div class="col-xs-12">
            <div class="row">
              <div class="col-xs-12">
                <risk-icon [risk]="assessment.risk" [showTooltip]="true"></risk-icon>
                <strong>{{assessment.name}} -- {{assessment.description | firstSentence}}</strong> {{assessment.description | restSentence}}
              </div>
            </div>
            <div class="row" style="margin: 10px 0px;">
              <div class="col-xs-{{ assessment.measurements.length | columnSize}}" *ngFor="let measurement of assessment.measurements">
                <form>
                  <mat-form-field class="full-width">
                    <mat-select #question name="question" (change)="updateRisks(question, measurement, assessment)" [value]="selectedValue(assessment, measurement, question)">
                      <mat-option [value]="defaultValue"></mat-option>
                      <mat-option *ngFor="let options of measurement.options" [value]="options.risk">
                        {{ options.name }}
                      </mat-option>
                    </mat-select>
                  </mat-form-field>
                </form>
              </div>
            </div>
          </div>
        </div>
      </mat-card-content>
    </div>

    <mat-card-actions class="text-right">
      <button mat-button color="primary" [disabled]="page === 1" (click)="back($event)"> Back</button>
      <button mat-raised-button color="primary" (click)="next($event)" *ngIf="!(buttonLabel === 'Save' && saved)"> {{buttonLabel}}</button>
      <button mat-raised-button color="primary" disabled *ngIf="buttonLabel === 'Save' && saved">
        <i class="material-icons text-success">check</i>&nbsp;Saved
      </button>
    </mat-card-actions>

  </mat-card>
</div>